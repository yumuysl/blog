import{g as V,u as W,h as X,i as Z,j as ee,k as se,l as le,m as R,n as C,p as e,q as ae,s as te,v as re,R as $,x as ie,y as oe,z as ce,A as ue,B as ne,C as I,D as T,E as Ee,F as he,G as ve,H as de,L as me,I as ye,J as Be,K as pe,M as j,N as Ae,O as D}from"./app-DUJe-SNa.js";const ge=["/intro.html","/","/codeshare/","/livelog/","/somelink/aboutme.html","/somelink/friendlink.html","/somelink/","/somelink/toolink.html","/codeshare/caseshare/","/codeshare/othershare/Lazyvim%E7%BC%96%E8%BE%91%E5%99%A8.html","/codeshare/othershare/","/codeshare/othershare/win11%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6.html","/codeshare/othershare/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html","/codeshare/othershare/%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%9C%BA%E5%B1%8F%E5%B9%95%E6%9B%BF%E6%8D%A2%E7%94%B5%E8%84%91%E9%BC%A0%E6%A0%87.html","/codeshare/othershare/%E6%8F%90%E5%8D%87vim%E7%BC%96%E8%BE%91%E4%BD%93%E9%AA%8C.html","/livelog/daily/%E5%8E%BB%E8%BF%87%E7%9A%84%E5%9C%B0%E6%96%B9.html","/livelog/daily/%E8%BF%99%E4%B8%AA%E4%B8%8D%E8%83%BD%E5%BF%8D.html","/livelog/daily/%E8%BF%99%E4%B8%AA%E5%BF%85%E9%A1%BB%E5%A4%B8.html","/livelog/daily/%E8%BF%99%E4%B8%AA%E8%BF%98%E8%83%BD%E5%BF%8D.html","/livelog/philosophy/","/livelog/philosophy/%E4%B8%80%E4%BA%9B%E6%83%B3%E6%B3%95.html","/livelog/philosophy/%E6%AF%9B%E9%80%89.html","/livelog/poetry/","/codeshare/caseshare/cssnotes/","/codeshare/caseshare/cssnotes/%E6%AF%9B%E7%8E%BB%E7%92%83%E6%95%88%E6%9E%9C.html","/codeshare/caseshare/tspros/","/codeshare/caseshare/tspros/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97.html","/codeshare/caseshare/tspros/%E8%B4%AA%E5%90%83%E8%9B%87.html","/livelog/poetry/libai/","/livelog/poetry/libai/%E5%AE%A3%E5%B7%9E%E8%B0%A2%E6%9C%93%E6%A5%BC%E9%A5%AF%E5%88%AB%E6%A0%A1%E4%B9%A6%E5%8F%94%E4%BA%91.html","/livelog/poetry/libai/%E5%B0%86%E8%BF%9B%E9%85%92.html","/livelog/poetry/sushi/","/livelog/poetry/sushi/%E5%AE%9A%E9%A3%8E%E6%B3%A2-%E8%8E%AB%E5%90%AC%E7%A9%BF%E6%9E%97%E6%89%93%E5%8F%B6%E5%A3%B0.html","/livelog/poetry/sushi/%E5%BF%B5%E5%A5%B4%E5%A8%87-%E8%B5%A4%E5%A3%81%E6%80%80%E5%8F%A4.html","/livelog/poetry/sushi/%E6%9C%9B%E6%B1%9F%E5%8D%97-%E6%98%A5%E6%9C%AA%E8%80%81.html","/livelog/poetry/sushi/%E6%B0%B4%E8%B0%83%E6%AD%8C%E5%A4%B4.html","/404.html","/livelog/daily/","/category/","/tag/","/tag/%E9%93%BE%E6%8E%A5/","/tag/linux/","/tag/win11/","/tag/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","/tag/%E5%93%B2%E5%AD%A6/","/tag/%E8%AF%97%E8%AF%8D/","/article/","/star/","/timeline/"],Fe="SLIMSEARCH_QUERY_HISTORY",B=j(Fe,[]),Ce=()=>{const{queryHistoryCount:t}=D;return{enabled:t>0,queryHistories:B,addQueryHistory:c=>{B.value=Array.from(new Set([c,...B.value.slice(0,t-1)]))},removeQueryHistory:c=>{B.value=[...B.value.slice(0,c),...B.value.slice(c+1)]}}},Q=t=>ge[t.id]+("anchor"in t?`#${t.anchor}`:""),De="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=D,p=j(De,[]),fe=()=>({enabled:M>0,resultHistories:p,addResultHistory:o=>{{const c={link:Q(o),display:o.display};"header"in o&&(c.header=o.header),p.value=[c,...p.value.slice(0,M-1)]}},removeResultHistory:o=>{p.value=[...p.value.slice(0,o),...p.value.slice(o+1)]}}),ke=t=>{const{page:o,routeLocale:c}=Ee(),f=he(),r=R(0),A=C(()=>r.value>0),E=ve([]);return de(()=>{const{search:k,terminate:d}=me(),g=Be(m=>{const{resultsFilter:H=a=>a,querySplitter:y,suggestionsFilter:S,...i}=f.value;m?(r.value+=1,k(m,c.value,i).then(a=>H(a,m,c.value,o.value)).then(a=>{r.value-=1,E.value=a}).catch(a=>{console.warn(a),r.value-=1,r.value||(E.value=[])})):E.value=[]},D.searchDelay-D.suggestDelay,{maxWait:5e3});ye([t,c],([m])=>g(m.join(" "))),pe(()=>{d()})}),{isSearching:A,results:E}};var be=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const c=W(),f=X(),r=Z(ee),{addQueryHistory:A,queryHistories:E,removeQueryHistory:k}=Ce(),{resultHistories:d,addResultHistory:g,removeResultHistory:m}=fe(),H=se(t,"queries"),{results:y,isSearching:S}=ke(H),i=le({isQuery:!0,index:0}),a=R(0),h=R(0),q=C(()=>E.value.length>0||d.value.length>0),b=C(()=>y.value.length>0),x=C(()=>y.value[a.value]||null),O=()=>{const{isQuery:s,index:l}=i;l===0?(i.isQuery=!s,i.index=s?d.value.length-1:E.value.length-1):i.index=l-1},U=()=>{const{isQuery:s,index:l}=i;l===(s?E.value.length-1:d.value.length-1)?(i.isQuery=!s,i.index=0):i.index=l+1},_=()=>{a.value=a.value>0?a.value-1:y.value.length-1,h.value=x.value.contents.length-1},P=()=>{a.value=a.value<y.value.length-1?a.value+1:0,h.value=0},Y=()=>{h.value<x.value.contents.length-1?h.value+=1:P()},z=()=>{h.value>0?h.value-=1:_()},w=s=>s.map(l=>Ae(l)?l:e(l[0],l[1])),G=s=>{if(s.type==="customField"){const l=ue[s.index]||"$content",[v,u=""]=ne(l)?l[f.value].split("$content"):l.split("$content");return s.display.map(n=>e("div",w([v,...n,u])))}return s.display.map(l=>e("div",w(l)))},F=()=>{a.value=0,h.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},E.value.map((s,l)=>{const v=i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v,onClick:()=>{o("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),k(l)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,l)=>{const v=!i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v},e($,{to:s.link,onClick:()=>{F()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(u=>w(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),m(l)}})]))}))]));return ae("keydown",s=>{if(t.isFocusing){if(b.value){if(s.key==="ArrowUp")z();else if(s.key==="ArrowDown")Y();else if(s.key==="Enter"){const l=x.value.contents[h.value];A(t.queries.join(" ")),g(l),c.push(Q(l)),F()}}else if(s.key==="ArrowUp")O();else if(s.key==="ArrowDown")U();else if(s.key==="Enter"){const{index:l}=i;i.isQuery?(s.preventDefault(),o("updateQuery",E.value[l])):(c.push(d.value[l].link),F())}}}),te([a,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!b.value:!q.value}]},t.queries.length?S.value?e(re,{hint:r.value.searching}):b.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:s,contents:l},v)=>{const u=a.value===v;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((n,N)=>{const L=u&&h.value===N;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e($,{to:Q(n),onClick:()=>{A(t.queries.join(" ")),g(n),F()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:q.value?[J(),K()]:r.value.emptyHistory)}});export{be as default};
