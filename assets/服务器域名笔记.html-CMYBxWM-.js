import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,f as t,o as n}from"./app-BSNJzrd9.js";const i={};function l(d,s){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h2 id="服务器" tabindex="-1"><a class="header-anchor" href="#服务器"><span>服务器</span></a></h2><h3 id="阿里云购买服务器" tabindex="-1"><a class="header-anchor" href="#阿里云购买服务器"><span>阿里云购买服务器</span></a></h3><ul><li>99元一年：2核2G</li><li>名称：登录阿里云查看</li><li>镜像ID：登录阿里云查看</li><li>地域：华北2（北京）</li><li>创建时间：2024年12月14日 23:49:00</li><li>到期时间：2025年12月14日 23:59:59到期</li><li>SSH远程连接问题：https://help.aliyun.com/zh/ecs/user-guide/ssh-remote-connection-problems/?spm=a2c4g.11186623.0.i2</li></ul><h3 id="服务器配置及运行环境-以debian为例" tabindex="-1"><a class="header-anchor" href="#服务器配置及运行环境-以debian为例"><span>服务器配置及运行环境(以debian为例)</span></a></h3><h4 id="账号及登录配置" tabindex="-1"><a class="header-anchor" href="#账号及登录配置"><span>账号及登录配置</span></a></h4><ul><li>为了安全考虑，得到一台服务器后禁用root登录，禁止密码登录只采用密钥登录</li><li>步骤： <ul><li>新增用户：使用 <code>sudo useradd -m -s /bin/bash newuser</code>命令创建账号，设置用户密码<code>sudo passwd newuser</code></li><li>安装ssh并启动ssh服务：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssh-server</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 安装ssh及其客户端</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssh-client</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # 启动服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 设置开机自启</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 检查服务状态</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生成ssh密钥对</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>ssh-keygen -t rsa -b 4096</span></span>
<span class="line"><span># 后续提示，可以一路回车</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在本地保存好私钥</li><li>切换到普通用户身份（这一步很重要，否则根目录还是root用户的，而后续会禁用root登录）</li><li>将公钥添加到服务器的<code>~/.ssh/authorized_keys</code>文件中 <ul><li>注意：确保<code>.ssh</code>目录的权限是700，<code>.ssh/authorized_keys</code>文件的权限是600</li></ul></li><li>切换到root用户</li><li>修改ssh配置文件 <ul><li>vim打开<code>/etc/ssh/sshd_config</code>文件</li><li>找到下列字段修改</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Port 2222                      # 修改默认端口</span></span>
<span class="line"><span>PermitRootLogin no             # 禁止root直接登录</span></span>
<span class="line"><span>PasswordAuthentication no      # 禁用密码登录（仅密钥，新手可选）</span></span>
<span class="line"><span>AllowUsers your_username       # 只允许特定用户登录（可选）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>重启ssh服务：<code>sudo systemctl restart sshd </code></li><li>修改防火墙或安全组：本人用阿里云服务器，在安全组中修改端口，允许ssh使用2222端口</li><li>在ssh客户端新开窗口测试是否生效</li></ul></li></ul><h4 id="更新软件源" tabindex="-1"><a class="header-anchor" href="#更新软件源"><span>更新软件源</span></a></h4><ul><li>如果是阿里云服务器，可以不需要换源，因为云服务器内部有加速</li><li>查看源：<code>cat /etc/apt/sources.list</code></li><li>备份源：<code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</code></li><li>编辑源：<code>sudo nano /etc/apt/sources.list</code>，编辑完后保存退出 <ul><li>需要先确定使用的 <code>Debian</code> 版本，如 <code>Bullseye</code> 、<code>Bookworm</code> 或 <code>Trixie</code> ：<code>sudo install lsb_release</code>、<code>lsb_release -a</code></li></ul></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>可用的源：</span></span>
<span class="line"><span>## 阿里镜像站</span></span>
<span class="line"><span>deb https://mirrors.aliyun.com/debian-security/ bookworm-security main</span></span>
<span class="line"><span>deb-src https://mirrors.aliyun.com/debian-security/ bookworm-security main</span></span>
<span class="line"><span></span></span>
<span class="line"><span>## 华为镜像站</span></span>
<span class="line"><span>deb https://mirrors.huaweicloud.com/debian-security/ bookworm-security main</span></span>
<span class="line"><span>deb-src https://mirrors.huaweicloud.com/debian-security/ bookworm-security main</span></span>
<span class="line"><span></span></span>
<span class="line"><span>## 中科大镜像站</span></span>
<span class="line"><span>deb https://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free non-free-firmware</span></span>
<span class="line"><span>deb-src https://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free non-free-firmware</span></span>
<span class="line"><span>deb https://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware</span></span>
<span class="line"><span>deb-src https://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware</span></span>
<span class="line"><span>deb https://mirrors.ustc.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>更新软件列表：<code>sudo apt update</code></li></ul><h4 id="nginx配置" tabindex="-1"><a class="header-anchor" href="#nginx配置"><span>Nginx配置</span></a></h4><ul><li>查看nginx版本：<code>nginx -v</code></li><li>查看nginx的状态：<code>systemctl status nginx</code></li><li>启动nginx：<code>systemctl start nginx</code></li><li>停止nginx：<code>systemctl stop nginx</code></li><li>重启nginx：<code>systemctl restart nginx</code></li><li>配置文件：<code>/etc/nginx/nginx.conf</code></li><li>重新加载配置：<code>sudo systemctl reload nginx</code></li><li>查看错误日志：<code>tail -f /var/log/nginx/error.log</code></li><li>nginx配置及其字段</li></ul><table><thead><tr><th style="text-align:left;">配置块/类别</th><th style="text-align:left;">指令/字段</th><th style="text-align:left;">说明与示例</th><th style="text-align:left;">备注/常见用途</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>全局块 (Main)</strong></td><td style="text-align:left;"><code>user</code></td><td style="text-align:left;">指定运行 Nginx worker 进程的用户和组。<br><strong>示例</strong>: <code>user nginx nginx;</code></td><td style="text-align:left;">出于安全考虑，建议使用非 root 用户。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>worker_processes</code></td><td style="text-align:left;">定义工作进程的数量。<br><strong>示例</strong>: <code>worker_processes auto;</code> (自动设置为 CPU 核心数)</td><td style="text-align:left;">推荐设置为 CPU 核心数或 <code>auto</code></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>error_log</code></td><td style="text-align:left;">设置错误日志的文件路径和记录级别。<br><strong>示例</strong>: <code>error_log /var/log/nginx/error.log warn;</code></td><td style="text-align:left;">级别: <code>debug</code>, <code>info</code>, <code>notice</code>, <code>warn</code>, <code>error</code>, <code>crit</code>, <code>alert</code>, <code>emerg</code></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>pid</code></td><td style="text-align:left;">指定存储 Nginx 主进程 PID 的文件位置。<br><strong>示例</strong>: <code>pid /var/run/nginx.pid;</code></td><td style="text-align:left;">用于管理服务</td></tr><tr><td style="text-align:left;"><strong>Events 块</strong></td><td style="text-align:left;"><code>worker_connections</code></td><td style="text-align:left;">设置<strong>每个</strong> worker 进程能够同时打开的最大连接数。<br><strong>示例</strong>: <code>worker_connections 1024;</code></td><td style="text-align:left;"><strong>最大客户端并发连接数</strong> ≈ <code>worker_processes</code> * <code>worker_connections</code></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>use</code></td><td style="text-align:left;">指定事件驱动模型。<br><strong>示例</strong>: <code>use epoll;</code></td><td style="text-align:left;">在 Linux 系统下高效的方式，通常可让 Nginx 自动选择</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>multi_accept</code></td><td style="text-align:left;">设置一个工作进程是否可以同时接受多个新连接。<br><strong>示例</strong>: <code>multi_accept on;</code></td><td style="text-align:left;">默认 <code>off</code></td></tr><tr><td style="text-align:left;"><strong>HTTP 块</strong></td><td style="text-align:left;"><code>include</code></td><td style="text-align:left;">引入其他配置文件。<br><strong>示例</strong>: <code>include /etc/nginx/mime.types;</code><br><code>include /etc/nginx/conf.d/*.conf;</code></td><td style="text-align:left;">实现配置的模块化管理</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>default_type</code></td><td style="text-align:left;">当无法识别文件类型时使用的默认 MIME 类型。<br><strong>示例</strong>: <code>default_type application/octet-stream;</code></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>access_log</code></td><td style="text-align:left;">设置访问日志的存放路径和使用的格式。<br><strong>示例</strong>: <code>access_log /var/log/nginx/access.log main;</code></td><td style="text-align:left;"><code>main</code> 为预定义的 <code>log_format</code> 名称</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>log_format</code></td><td style="text-align:left;">定义访问日志的格式。<br><strong>示例</strong>: <pre>log_format main &#39;$remote_addr - <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>m</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mi>u</mi></msub><mi>s</mi><mi>e</mi><mi>r</mi><mo stretchy="false">[</mo></mrow><annotation encoding="application/x-tex">remote_user [</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mopen">[</span></span></span></span>time_local] &quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><msup><mi mathvariant="normal">&quot;</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>&lt;</mo><mi>b</mi><mi>r</mi><msup><mo>&gt;</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">request&quot; &#39;&lt;br&gt;                  &#39;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord">&quot;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.791em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel">&gt;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>status <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>o</mi><mi>d</mi><msub><mi>y</mi><mi>b</mi></msub><mi>y</mi><mi>t</mi><mi>e</mi><msub><mi>s</mi><mi>s</mi></msub><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">body_bytes_sent &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">&quot;</span></span></span></span>http_referer&quot; &#39;<br>                  &#39;&quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>t</mi><mi>t</mi><msub><mi>p</mi><mi>u</mi></msub><mi>s</mi><mi>e</mi><msub><mi>r</mi><mi>a</mi></msub><mi>g</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">http_user_agent&quot; &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">tt</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">&quot;&quot;</span></span></span></span>http_x_forwarded_for&quot;&#39;;</pre></td><td style="text-align:left;">定义日志的记录内容</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>sendfile</code></td><td style="text-align:left;">设置为 <code>on</code> 时，启用高效文件传输模式（零拷贝）。<br><strong>示例</strong>: <code>sendfile on;</code></td><td style="text-align:left;">提升静态文件服务性能，建议开启。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>keepalive_timeout</code></td><td style="text-align:left;">设置客户端与服务器之间长连接的超时时间（秒）。<br><strong>示例</strong>: <code>keepalive_timeout 65;</code></td><td style="text-align:left;">减少 TCP 连接建立和关闭的开销。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>gzip</code></td><td style="text-align:left;">设置为 <code>on</code> 可启用 Gzip 压缩，减少网络传输数据量。<br><strong>示例</strong>: <code>gzip on;</code><br><code>gzip_min_length 1k;</code><br><code>gzip_types text/plain text/css application/json;</code></td><td style="text-align:left;">对文本类资源进行压缩，有效节省带宽</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>client_max_body_size</code></td><td style="text-align:left;">设置客户端请求体的最大允许大小。<br><strong>示例</strong>: <code>client_max_body_size 20M;</code></td><td style="text-align:left;">常用于文件上传，限制上传文件大小</td></tr><tr><td style="text-align:left;"><strong>Server 块</strong></td><td style="text-align:left;"><code>listen</code></td><td style="text-align:left;">指定服务器监听的 IP 地址和端口。<br><strong>示例</strong>: <code>listen 80;</code><br><code>listen 443 ssl;</code></td><td style="text-align:left;">定义该虚拟主机监听哪个端口和IP上的请求</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>server_name</code></td><td style="text-align:left;">指定服务器名称（域名），用于匹配请求。<br><strong>示例</strong>: <code>server_name example.com www.example.com;</code></td><td style="text-align:left;">支持通配符和正则匹配。<code>_</code> 或 <code>default_server</code> 可处理未匹配的请求</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>root</code></td><td style="text-align:left;">设置该虚拟主机的网站根目录。<br><strong>示例</strong>: <code>root /var/www/example.com;</code></td><td style="text-align:left;">指定该站点文件存放的根目录</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>index</code></td><td style="text-align:left;">指定默认的索引文件。<br><strong>示例</strong>: <code>index index.html index.htm index.php;</code></td><td style="text-align:left;">当请求指向目录时，Nginx 会尝试返回该指令指定的文件</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>error_page</code></td><td style="text-align:left;">自定义错误页面。<br><strong>示例</strong>: <code>error_page 404 /404.html;</code><br><code>error_page 500 502 503 504 /50x.html;</code></td><td style="text-align:left;">为用户提供更友好的错误提示页面</td></tr><tr><td style="text-align:left;"><strong>Location 块</strong></td><td style="text-align:left;"><code>root</code></td><td style="text-align:left;">设置请求的根目录（覆盖 Server 块的 <code>root</code>）。<br><strong>示例</strong>: <code>root /var/www/html;</code></td><td style="text-align:left;">通常用于指定特定路径下的资源位置</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>alias</code></td><td style="text-align:left;">定义路径别名，用于将特定 location 映射到文件系统路径。<br><strong>示例</strong>: <code>location /images/ { alias /data/static/imgs/; }</code></td><td style="text-align:left;">访问 <code>/images/logo.png</code> 将返回 <code>/data/static/imgs/logo.png</code>。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>try_files</code></td><td style="text-align:left;">按顺序检查文件或目录是否存在，否则内部重定向或返回状态码。<br><strong>示例</strong>: <code>try_files $uri $uri/ /index.php?$query_string;</code></td><td style="text-align:left;">常用于单页应用 (SPA) 或优雅的 URL 重写</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>proxy_pass</code></td><td style="text-align:left;">将请求反向代理到指定的后端服务器或 upstream 组。<br><strong>示例</strong>: <code>proxy_pass http://backend_server;</code></td><td style="text-align:left;">Nginx 作为反向代理的核心指令</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>proxy_set_header</code></td><td style="text-align:left;">重新定义或添加传递给代理服务器的请求头。<br><strong>示例</strong>: <pre>proxy_set_header Host $host;<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</pre></td><td style="text-align:left;">确保后端服务器获取客户端真实信息 <a href="@ref">1</a>。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>rewrite</code></td><td style="text-align:left;">根据正则表达式重写 URL。<br><strong>示例</strong>: <code>rewrite ^/old/(.*)$ /new/$1 permanent;</code></td><td style="text-align:left;"><code>permanent</code> 返回 301 永久重定向，<code>last</code> 或 <code>break</code> 用于内部重写</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>expires</code></td><td style="text-align:left;">设置浏览器缓存时间。<br><strong>示例</strong>: <code>expires 30d;</code> (缓存30天)<br><code>expires -1;</code> (永远过期)</td><td style="text-align:left;">为静态资源设置浏览器缓存，减少重复请求</td></tr><tr><td style="text-align:left;"><strong>Upstream 块</strong></td><td style="text-align:left;"><code>server</code></td><td style="text-align:left;">定义后端服务器地址和参数。<br><strong>示例</strong>: <pre>upstream backend {<br>    server backend1.example.com:8080 weight=5;<br>    server backend2.example.com:8080 max_fails=3 fail_timeout=30s;<br>    server backup.example.com:8080 backup;<br>}</pre></td><td style="text-align:left;"><code>weight</code>(权重), <code>max_fails</code>(最大失败次数), <code>fail_timeout</code>(失败超时), <code>backup</code>(备份服务器) <a href="@ref">1,5</a>。</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">Load Balancing Method</td><td style="text-align:left;">负载均衡算法。<br><strong>示例</strong>: (在 upstream 块中指定) <pre>upstream backend {<br>    least_conn; # 最少连接<br>    server 192.168.1.10;<br>    server 192.168.1.11;<br>}</pre></td><td style="text-align:left;">默认为 <strong>轮询 (Round Robin)</strong>。其他算法: <strong>IP 哈希 (ip_hash)</strong> (会话保持), <strong>最少连接 (least_conn)</strong></td></tr></tbody></table><ul><li>配置示例：</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>http {</span></span>
<span class="line"><span>    server {</span></span>
<span class="line"><span>        listen 80;  # 监听端口</span></span>
<span class="line"><span>        server_name example.com;  # 你的域名</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>            root /var/www/html;  # 网站根目录</span></span>
<span class="line"><span>            index index.html index.htm;  # 默认首页文件</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        error_page 404 /404.html;  # 自定义404页面</span></span>
<span class="line"><span>        location = /404.html {</span></span>
<span class="line"><span>            internal;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nginx配置SSL证书：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>server {</span></span>
<span class="line"><span>    listen       443 ssl;     #证书监听端口</span></span>
<span class="line"><span>   server_name  blog.haysaloe.top;  #域名</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    ssl_certificate /usr/local/nginx/ssl/haysaloe_top.pem;  #证书位置</span></span>
<span class="line"><span>    ssl_certificate_key /usr/local/nginx/ssl/haysaloe_top.key;  #密码路径</span></span>
<span class="line"><span>    ssl_session_cache shared:SSL:1m;</span></span>
<span class="line"><span>    ssl_session_timeout 5m;</span></span>
<span class="line"><span>    ssl_ciphers &#39;ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES128-GCM-SHA256:AEAD-AES256-GCM-SHA384:!MD5:!ADH:!RC4&#39;;  # 证书加密允许协议和禁用的协议</span></span>
<span class="line"><span>    ssl_protocols TLSv1.2 TLSv1.3;  # 指定支持的SSL/TLS协议版本</span></span>
<span class="line"><span>    ssl_prefer_server_ciphers  on;  # 优先选择自身定义的加密算法而非客户端提供的</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>        root  html;</span></span>
<span class="line"><span>        index index.html index.htm;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>检查nginx的语法是否有错误：<code>sudo nginx -t</code></li><li>查看nginx运行过程中的错误日志：<code>tail -f /var/log/nginx/error.log</code></li></ul><h3 id="其他配置" tabindex="-1"><a class="header-anchor" href="#其他配置"><span>其他配置</span></a></h3><ul><li>终端颜色：当Linux终端无颜色且ls命令输出为白色无法区分文件和文件夹，在root用户下： <ul><li><code>dircolors -p &gt; ~/.dircolors</code> ，生成默认配置文件</li><li>可以更改.dirclors文件颜色，这里按照默认的</li><li>打开<code>~/.bashrc</code>文件，尾部新增下列代码</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">eval</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dircolors</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.dircolors)&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 引入颜色，区分文件类型</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">alias</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ls</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ls --color=auto&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 设置别名，颜色区分文件和文件夹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启用配置：<code>source ~/.bashrc</code></li></ul></li><li>颜色代码参考</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>文本属性​：00（无）、01（粗体）、04（下划线）、05（闪烁）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>前景色（文本颜色）​​：30（黑）、31（红）、32（绿）、33（黄）、34（蓝）、35（品红）、36（青）、37（白）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>背景色​：40（黑）、41（红）、42（绿）、43（黄）、44（蓝）、45（品红）、46（青）、47（白）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例​：di=01;34;44表示目录显示为粗体蓝色文字（01;34） on 蓝色背景（44）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="域名" tabindex="-1"><a class="header-anchor" href="#域名"><span>域名</span></a></h2><h3 id="域名备案" tabindex="-1"><a class="header-anchor" href="#域名备案"><span>域名备案</span></a></h3><ul><li>得到一个域名后，需要进行IP备案，才能使用该域名，包括网站和APP</li><li>阿里云购买的域名在实名认证后进行ICP备案 <ul><li>阿里云备案系统</li><li>不同地区上传材料不同，在阿里云查询所需要的资料后提前准备</li></ul></li></ul><h3 id="域名解析" tabindex="-1"><a class="header-anchor" href="#域名解析"><span>域名解析</span></a></h3><ul><li>域名解析是将域名映射到IP地址的过程，使得用户可以通过域名访问网站或应用。</li><li>一个一级域名可以解析到多个二级域名或多个三级域名，但一个二级域名或三级域名只能解析到一个IP地址。</li></ul><h4 id="dns解析" tabindex="-1"><a class="header-anchor" href="#dns解析"><span>DNS解析</span></a></h4><ul><li>类型：常用的有<code>A</code>、<code>AAAA</code>、<code>CNAME</code>、<code>NS</code>等记录类型，其中<code>A</code>记录指向<code>pv4</code>，<code>AAAA</code>指向<code>ipv6</code>，<code>CNAME</code>指向另一个域名，<code>NS</code>指向<code>DNS</code></li><li>名称：通常值得是子域名名称，如<code>www.baidu.com</code>，这里的名称为<code>www</code>，但当名称为@时指向根域名，即<code>baidu.com</code></li><li>内容：真实的IP地址</li></ul>`,28)])])}const p=e(i,[["render",l]]),c=JSON.parse('{"path":"/notes/endnotes/domain/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%9F%E5%90%8D%E7%AC%94%E8%AE%B0.html","title":"服务器域名笔记","lang":"zh-CN","frontmatter":{"title":"服务器域名笔记","date":"2024-12-15T00:00:00.000Z","description":"服务器、域名及部署相关笔记","article":false,"feed":false,"seo":false,"head":[]},"git":{"createdTime":1739065138000,"updatedTime":1756821233000,"contributors":[{"name":"bestoaloe","username":"","email":"yinchuanyjw@outlook.com","commits":1},{"name":"yumuysl","username":"","email":"yinchuanyjw@outlook.com","commits":1}]},"readingTime":{"minutes":8.58,"words":2575},"filePathRelative":"notes/endnotes/domain/服务器域名笔记.md"}');export{p as comp,c as data};
